# Setu

SDK to help Pythonistas integrate with Setu's APIs

The following APIs are currently supported.

- UPI DeepLinks

We're constantly adding new API support. Feel free to reach out to us if you
can't see an API.

## Installation

```bash
pip install setu
```

## Usage

### UPI DeepLinks

The following actions are currently supported

- Generate payment link
- Check status of payment link
- Trigger a mock payment - for testing purposes
- Initiate refunds on payments made

#### Configuration

```python
from setu import deeplink

dl = deeplink.Deeplink(
    "YOUR SCHEME ID",
    "YOUR JWT SECRET",
    "YOUR PRODUCT INSTANCE ID",
    mode="PRODUCTION | SANDBOX" # default SANDBOX,
    authType= "JWT | OAUTH" # default JWT
)
```

#### Generate UPI payment link

```python
payload = PaymentLinkPayload(
    amount={"unit": "INR", "value": Number},
    amount_exactness=String,
    biller_bill_id=String,
    settlement={
        "parts": [
            {
                "account": {"id": String, "ifsc": String},
                "split": {"unit": "INR", "value": Number},
            },
            {
                "account": {"id": String, "ifsc": String},
                "split": {"unit": "INR", "value": Number},
            },
        ],
        "primaryAccount": {"id": String, "ifsc": String},
        "split": {"unit": "INR", "value": Number},
    }, # optional
    additionalInfo=Object, # optional
    campaignID=String, # optional
    dueDate=String, # optional
    expiryDate=String, # optional
    name=String, # optional
    transactionNote=String # optional
    validationRules=Object, # optional
)

link = dl.create_payment_link(payload)
print(link)
```

#### Check status of UPI payment link

```python
status = dl.check_payment_status(
        platformBillID=String
    )
print(status)
```

#### Trigger mock payment for UPI payment link - ONLY IN SANDBOX ⚠️

```python
status = dl.trigger_mock_payment(
        amountValue=Number, # Decimal Value
        upiID=String # UPI ID generated by create_payment_link method
    )
print(status)
```

#### Initiate refund on payments to UPI payment link

```python
# configuration
refund = BatchRefund(
    "YOUR SCHEME ID",
    "YOUR JWT SECRET",
    "YOUR PRODUCT INSTANCE ID",
    mode="PRODUCTION | SANDBOX" # default SANDBOX,
    authType= "JWT | OAUTH" # default JWT
)

payload = Payload(
    [
        {
            "seqNo": Number, # Can be any unique number
            "identifier": "PLATFORM BILL ID", # Platform bill ID returned from the payment-link API
            "identifierType": "BILL_ID",
            "refundType": "PARTIAL | FULL",
            "refundAmount": {"currencyCode": "INR", "value": Number},
            "deductions": [
                {
                    "account": {
                        "id": String,
                        "ifsc": String,
                    },
                    "split": {"unit": "INR", "value": Number},
                },
                {
                    "account": {
                        "id": String,
                        "ifsc": String,
                    },
                    "split": {"unit": "INR", "value": Number},
                },
            ],
        },
    ]
)

response = refund.initiate_batch_refund(payload)
print(response)
```

#### Check refund status

```python
status = refund.get_refund_status(
        refund_id=String # Refund ID returned from initiate-batch-refund API
)
print(status)
```

## License

MIT
